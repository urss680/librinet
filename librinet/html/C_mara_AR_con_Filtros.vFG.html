```html
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CÃ¡mara AR con Filtros</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: Arial, sans-serif;
        background: #000;
        overflow: hidden;
        position: relative;
    }
    
    #video {
        width: 100%;
        height: 100vh;
        object-fit: cover;
        transform: scaleX(-1);
    }
    
    #canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    
    .controls {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 15px;
        background: rgba(0,0,0,0.7);
        padding: 15px;
        border-radius: 50px;
        backdrop-filter: blur(10px);
        flex-wrap: wrap;
        max-width: 90vw;
        justify-content: center;
    }
    
    .filter-btn {
        width: 60px;
        height: 60px;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 30px;
        background: rgba(255,255,255,0.2);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .filter-btn:hover {
        transform: scale(1.1);
        background: rgba(255,255,255,0.3);
    }
    
    .filter-btn.active {
        background: rgba(255,255,255,0.5);
        box-shadow: 0 0 20px rgba(255,255,255,0.5);
    }
    
    .capture-btn {
        width: 70px;
        height: 70px;
        border: 3px solid #fff;
        border-radius: 50%;
        background: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .capture-btn:active {
        transform: scale(0.9);
    }
    
    .gallery-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 10px;
        background: rgba(255,255,255,0.2);
        cursor: pointer;
        font-size: 24px;
    }
    
    .flash {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        opacity: 0;
        pointer-events: none;
    }
    
    @keyframes flashAnimation {
        0% { opacity: 0; }
        50% { opacity: 0.8; }
        100% { opacity: 0; }
    }
    
    /* Pantalla de permisos */
    .permission-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    .permission-content {
        text-align: center;
        color: white;
        padding: 40px;
        max-width: 400px;
    }
    
    .permission-icon {
        font-size: 80px;
        margin-bottom: 20px;
    }
    
    .permission-title {
        font-size: 24px;
        margin-bottom: 15px;
        font-weight: bold;
    }
    
    .permission-text {
        font-size: 16px;
        margin-bottom: 30px;
        opacity: 0.9;
        line-height: 1.5;
    }
    
    .permission-btn {
        background: white;
        color: #667eea;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .permission-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .permission-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    .loading-spinner {
        display: none;
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255,255,255,0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .hidden {
        display: none !important;
    }
</style>
</head>
<body>

<!-- Pantalla de permisos -->
<div class="permission-screen" id="permissionScreen">
    <div class="permission-content">
        <div class="permission-icon">ğŸ“·</div>
        <h2 class="permission-title">Permitir acceso a la cÃ¡mara</h2>
        <p class="permission-text">
            Para poder usar los filtros de realidad aumentada, necesitamos acceso a tu cÃ¡mara. 
            Tus fotos se procesarÃ¡n localmente en tu dispositivo.
        </p>
        <button class="permission-btn" id="permissionBtn" onclick="requestCameraPermission()">
            Activar cÃ¡mara
        </button>
        <div class="loading-spinner" id="loadingSpinner"></div>
    </div>
</div>

<video id="video" autoplay></video>
<canvas id="canvas"></canvas>
<div class="flash" id="flash"></div>

<button class="gallery-btn" onclick="openGallery()">ğŸ“·</button>

<div class="controls">
    <button class="filter-btn" data-filter="none" onclick="setFilter('none')">ğŸ˜Š</button>
    <button class="filter-btn" data-filter="dog" onclick="setFilter('dog')">ğŸ¶</button>
    <button class="filter-btn" data-filter="cat" onclick="setFilter('cat')">ğŸ±</button>
    <button class="filter-btn" data-filter="rabbit" onclick="setFilter('rabbit')">ğŸ°</button>
    <button class="filter-btn" data-filter="panda" onclick="setFilter('panda')">ğŸ¼</button>
    <button class="filter-btn" data-filter="fox" onclick="setFilter('fox')">ğŸ¦Š</button>
    <button class="filter-btn" data-filter="bear" onclick="setFilter('bear')">ğŸ»</button>
    <button class="filter-btn" data-filter="pig" onclick="setFilter('pig')">ğŸ·</button>
    <button class="filter-btn" data-filter="monkey" onclick="setFilter('monkey')">ğŸµ</button>
    <button class="filter-btn" data-filter="lion" onclick="setFilter('lion')">ğŸ¦</button>
    <button class="filter-btn" data-filter="tiger" onclick="setFilter('tiger')">ğŸ¯</button>
    <button class="filter-btn" data-filter="glasses" onclick="setFilter('glasses')">ğŸ•¶ï¸</button>
    <button class="filter-btn" data-filter="sunglasses" onclick="setFilter('sunglasses')">ğŸ˜</button>
    <button class="filter-btn" data-filter="nerd" onclick="setFilter('nerd')">ğŸ¤“</button>
    <button class="filter-btn" data-filter="crown" onclick="setFilter('crown')">ğŸ‘‘</button>
    <button class="filter-btn" data-filter="party" onclick="setFilter('party')">ğŸ‰</button>
    <button class="filter-btn" data-filter="halo" onclick="setFilter('halo')">ğŸ˜‡</button>
    <button class="filter-btn" data-filter="devil" onclick="setFilter('devil')">ğŸ˜ˆ</button>
    <button class="filter-btn" data-filter="clown" onclick="setFilter('clown')">ğŸ¤¡</button>
    <button class="filter-btn" data-filter="robot" onclick="setFilter('robot')">ğŸ¤–</button>
    <button class="filter-btn" data-filter="alien" onclick="setFilter('alien')">ğŸ‘½</button>
    <button class="filter-btn" data-filter="ghost" onclick="setFilter('ghost')">ğŸ‘»</button>
    <button class="filter-btn" data-filter="skull" onclick="setFilter('skull')">ğŸ’€</button>
    <button class="filter-btn" data-filter="heart" onclick="setFilter('heart')">â¤ï¸</button>
    <button class="filter-btn" data-filter="star" onclick="setFilter('star')">â­</button>
    <button class="filter-btn" data-filter="rainbow" onclick="setFilter('rainbow')">ğŸŒˆ</button>
    <button class="filter-btn" data-filter="fire" onclick="setFilter('fire')">ğŸ”¥</button>
    <button class="filter-btn" data-filter="lightning" onclick="setFilter('lightning')">âš¡</button>
    <button class="filter-btn" data-filter="snow" onclick="setFilter('snow')">â„ï¸</button>
    <button class="filter-btn" data-filter="diamond" onclick="setFilter('diamond')">ğŸ’</button>
    <button class="filter-btn" data-filter="money" onclick="setFilter('money')">ğŸ’°</button>
    <button class="filter-btn" data-filter="unicorn" onclick="setFilter('unicorn')">ğŸ¦„</button>
    <button class="filter-btn" data-filter="dragon" onclick="setFilter('dragon')">ğŸ‰</button>
    <button class="filter-btn" data-filter="butterfly" onclick="setFilter('butterfly')">ğŸ¦‹</button>
    <button class="filter-btn" data-filter="flower" onclick="setFilter('flower')">ğŸŒ¸</button>
    <button class="filter-btn" data-filter="mustache" onclick="setFilter('mustache')">ğŸ‘¨â€</button>
    <button class="filter-btn" data-filter="beard" onclick="setFilter('beard')">ğŸ§”</button>
    <button class="filter-btn" data-filter="makeup" onclick="setFilter('makeup')">ğŸ’„</button>
    <button class="filter-btn" data-filter="tattoo" onclick="setFilter('tattoo')">ğŸ—¿</button>
    <button class="filter-btn" data-filter="viking" onclick="setFilter('viking')">ğŸª“</button>
    <button class="filter-btn" data-filter="pirate" onclick="setFilter('pirate')">ğŸ´â€â˜ ï¸</button>
    <button class="filter-btn" data-filter="ninja" onclick="setFilter('ninja')">ğŸ¥·</button>
    <button class="filter-btn" data-filter="superhero" onclick="setFilter('superhero')">ğŸ¦¸</button>
    <button class="filter-btn" data-filter="vampire" onclick="setFilter('vampire')">ğŸ§›</button>
    <button class="filter-btn" data-filter="zombie" onclick="setFilter('zombie')">ğŸ§Ÿ</button>
    <button class="capture-btn" onclick="capture()"></button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@latest/dist/face-landmarks-detection.min.js"></script>
<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const permissionScreen = document.getElementById('permissionScreen');
    const permissionBtn = document.getElementById('permissionBtn');
    const loadingSpinner = document.getElementById('loadingSpinner');
    let currentFilter = 'none';
    let stream;
    let model;
    let faces = [];
    
    // Solicitar permiso de cÃ¡mara
    async function requestCameraPermission() {
        permissionBtn.disabled = true;
        loadingSpinner.style.display = 'block';
        permissionBtn.textContent = 'Activando cÃ¡mara...';
        
        try {
            await initCamera();
            permissionScreen.classList.add('hidden');
        } catch (err) {
            console.error('Error al acceder a la cÃ¡mara:', err);
            permissionBtn.disabled = false;
            loadingSpinner.style.display = 'none';
            permissionBtn.textContent = 'Reintentar';
            
            if (err.name === 'NotAllowedError') {
                alert('Por favor permite el acceso a la cÃ¡mara en la configuraciÃ³n de tu navegador.');
            } else if (err.name === 'NotFoundError') {
                alert('No se encontrÃ³ una cÃ¡mara en tu dispositivo.');
            } else {
                alert('Error al acceder a la cÃ¡mara: ' + err.message);
            }
        }
    }
    
    // Inicializar modelo de detecciÃ³n facial
    async function initModel() {
        model = await faceLandmarksDetection.load(
            faceLandmarksDetection.SupportedPackages.mediapipeFacemesh,
            { maxFaces: 1 }
        );
    }
    
    // Iniciar cÃ¡mara
    async function initCamera() {
        stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: 'user' },
            audio: false 
        });
        video.srcObject = stream;
        
        video.onloadedmetadata = async () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            await initModel();
            await trackFaces();
        };
    }
    
    // Seguimiento facial
    async function trackFaces() {
        while (true) {
            if (video.readyState === 4) {
                faces = await model.estimateFaces({ input: video });
                drawFilter();
            }
            await new Promise(resolve => setTimeout(resolve, 1000 / 30)); // 30 FPS
        }
    }
    
    // Obtener posiciÃ³n y tamaÃ±o real de la cara basado en puntos clave
    function getFacePosition() {
        if (faces.length > 0) {
            const keypoints = faces[0].keypoints;
            
            // Obtener puntos de referencia para calcular el tamaÃ±o
            const left = Math.min(...keypoints.map(p => p.x));
            const right = Math.max(...keypoints.map(p => p.x));
            const top = Math.min(...keypoints.map(p => p.y));
            const bottom = Math.max(...keypoints.map(p => p.y));
            
            const centerX = (left + right) / 2;
            const centerY = (top + bottom) / 2;
            const width = right - left;
            const height = bottom - top;
            
            // Calcular rotaciÃ³n basada en los ojos
            const leftEye = keypoints[33];
            const rightEye = keypoints[263];
            const rotation = Math.atan2(rightEye.y - leftEye.y, rightEye.x - leftEye.x);
            
            return {
                x: centerX,
                y: centerY,
                width: width,
                height: height,
                rotation: rotation,
                scale: width / 200 // Escala relativa a una cara de referencia
            };
        }
        return null;
    }
    
    // Dibujar filtros adaptativos
    function drawFilter() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (currentFilter !== 'none') {
            const face = getFacePosition();
            if (face) {
                ctx.save();
                ctx.translate(face.x, face.y);
                ctx.rotate(face.rotation);
                ctx.scale(-1, 1);
                
                // Ajustar el tamaÃ±o del filtro basado en el tamaÃ±o real de la cara
                const baseSize = face.width * 0.8;
                const centerX = 0;
                const centerY = 0;
                const size = baseSize;
                
                // ImplementaciÃ³n de filtros (simplificada para ejemplo)
                ctx.font = `${size}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(getFilterEmoji(currentFilter), centerX, centerY);
                
                ctx.restore();
            }
        }
    }
    
    // Obtener emoji del filtro
    function getFilterEmoji(filter) {
        const emojis = {
            'dog': 'ğŸ¶',
            'cat': 'ğŸ±',
            'rabbit': 'ğŸ°',
            'panda': 'ğŸ¼',
            'fox': 'ğŸ¦Š',
            'bear': 'ğŸ»',
            'pig': 'ğŸ·',
            'monkey': 'ğŸµ',
            'lion': 'ğŸ¦',
            'tiger': 'ğŸ¯',
            'glasses': 'ğŸ•¶ï¸',
            'sunglasses': 'ğŸ˜',
            'nerd': 'ğŸ¤“',
            'crown': 'ğŸ‘‘',
            'party': 'ğŸ‰',
            'halo': 'ğŸ˜‡',
            'devil': 'ğŸ˜ˆ',
            'clown': 'ğŸ¤¡',
            'robot': 'ğŸ¤–',
            'alien': 'ğŸ‘½',
            'ghost': 'ğŸ‘»',
            'skull': 'ğŸ’€',
            'heart': 'â¤ï¸',
            'star': 'â­',
            'rainbow': 'ğŸŒˆ',
            'fire': 'ğŸ”¥',
            'lightning': 'âš¡',
            'snow': 'â„ï¸',
            'diamond': 'ğŸ’',
            'money': 'ğŸ’°',
            'unicorn': 'ğŸ¦„',
            'dragon': 'ğŸ‰',
            'butterfly': 'ğŸ¦‹',
            'flower': 'ğŸŒ¸',
            'mustache': 'ğŸ‘¨',
            'beard': 'ğŸ§”',
            'makeup': 'ğŸ’„',
            'tattoo': 'ğŸ—¿',
            'viking': 'ğŸª“',
            'pirate': 'ğŸ´â€â˜ ï¸',
            'ninja': 'ğŸ¥·',
            'superhero': 'ğŸ¦¸',
            'vampire': 'ğŸ§›',
            'zombie': 'ğŸ§Ÿ'
        };
        return emojis[filter] || 'ğŸ˜Š';
    }
    
    // Establecer filtro
    function setFilter(filter) {
        currentFilter = filter;
        
        // Actualizar botones activos
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.filter === filter) {
                btn.classList.add('active');
            }
        });
    }
    
    // Capturar foto
    function capture() {
        const flash = document.getElementById('flash');
        flash.style.animation = 'flashAnimation 0.3s';
        
        setTimeout(() => {
            flash.style.animation = 'none';
        }, 300);
        
        // AquÃ­ puedes implementar la lÃ³gica para guardar la foto
        console.log('Foto capturada con filtro:', currentFilter);
    }
    
    // Abrir galerÃ­a
    function openGallery() {
        console.log('Abrir galerÃ­a');
        // Implementar lÃ³gica para abrir galerÃ­a
    }
    
    // Inicializar con el filtro por defecto
    setFilter('none');
</script>
</body>
</html>
```